<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weraser - AI Knowledge Platform</title>
    <link rel="stylesheet" href="assets/shared.css">
    <link rel="stylesheet" href="gemini-api.css">
    <!-- Gemini API Integration -->
    <script src="config-secure.js"></script>
    <script src="gemini-direct.js"></script>
    <script src="gemini-mock.js"></script>
    <script src="gemini-smart.js"></script>
    <script src="gemini-api.js"></script>
    <style>
        /* Hide Gemini API Modal - No modal needed */
        .gemini-api-modal {
            display: none !important;
        }
        
        /* Notion-inspired Clean Design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #ffffff;
            color: #37352f;
            line-height: 1.5;
        }
        
        /* Layout Structure */
        .weraser-app {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Navigation Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 45px;
            background: #ffffff;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 18px;
        }
        
        .nav-icon:hover {
            background: #f1f1ef;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            color: #37352f;
            margin-left: 12px;
        }
        
        .breadcrumb-separator {
            color: #a4a4a2;
            margin: 0 4px;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .breadcrumb-item:hover {
            background: #f1f1ef;
        }
        
        .breadcrumb-current {
            font-weight: 500;
        }
        
        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-action {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .header-action:hover {
            background: #f1f1ef;
        }
        
        /* Main Content Area */
        .app-body {
            display: flex;
            width: 100%;
            margin-top: 45px;
            height: calc(100vh - 45px);
        }
        
        /* Sidebar - 2 Level Navigation */
        .sidebar {
            width: 260px;
            background: #fbfbfa;
            border-right: 1px solid #e9e9e7;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .sidebar-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .back-button:hover {
            background: #e9e9e7;
        }
        
        .sidebar-section {
            padding: 16px;
        }
        
        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            color: #a4a4a2;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .icon-button {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            color: #a4a4a2;
        }
        
        .icon-button:hover {
            background: #e9e9e7;
            color: #37352f;
        }
        
        /* Project List */
        .project-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .project-item {
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .project-item:hover {
            background: #f1f1ef;
        }
        
        .project-item-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        
        .project-icon {
            font-size: 16px;
        }
        
        .project-name {
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
        }
        
        .project-meta {
            display: flex;
            gap: 12px;
            margin-left: 24px;
            font-size: 12px;
            color: #a4a4a2;
        }
        
        .doc-count, .chat-count {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Chat List */
        .chat-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .chat-item {
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .chat-item:hover {
            background: #f1f1ef;
        }
        
        .chat-item.active {
            background: #e9e9e7;
        }
        
        .chat-title {
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
            margin-bottom: 2px;
        }
        
        .chat-preview {
            font-size: 12px;
            color: #a4a4a2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-time {
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 11px;
            color: #a4a4a2;
        }
        
        .empty-state {
            text-align: center;
            padding: 24px;
            color: #a4a4a2;
        }
        
        .text-button {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .text-button:hover {
            background: #f1f1ef;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }
        
        .chat-header {
            padding: 12px 20px;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .chat-header-title {
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
        }
        
        .chat-header-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-button {
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            border: none;
            background: transparent;
            color: #787774;
        }
        
        .action-button:hover {
            background: #f1f1ef;
            color: #37352f;
        }
        
        .action-button.active {
            background: #e9e9e7;
            color: #37352f;
        }
        
        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 24px;
        }
        
        /* Loading Spinner */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            margin: 8px 0;
            background: #f7f6f3;
            border-radius: 8px;
            animation: fadeIn 0.3s ease;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #787774;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            background: #f1f1ef;
        }
        
        .message-avatar--ai {
            background: linear-gradient(135deg, #0066FF, #00D4AA);
            color: white;
        }
        
        .message-sender {
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
        }
        
        .message-time {
            font-size: 12px;
            color: #a4a4a2;
        }
        
        .message-content {
            margin-left: 36px;
        }
        
        .message-edit-wrapper {
            position: relative;
        }
        
        .message-text {
            font-size: 14px;
            line-height: 1.6;
            color: #37352f;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .message-text[contenteditable="true"] {
            background: #f7f6f3;
            outline: 2px solid #0066FF;
            outline-offset: 2px;
        }
        
        .edit-button {
            position: absolute;
            right: -30px;
            top: 8px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            background: #ffffff;
            border: 1px solid #e9e9e7;
        }
        
        .message:hover .edit-button {
            opacity: 1;
        }
        
        .thinking-process {
            margin-top: 8px;
            padding: 8px;
            background: #f7f6f3;
            border-radius: 6px;
            font-size: 13px;
            color: #787774;
        }
        
        .thinking-header {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            user-select: none;
        }
        
        .thinking-content {
            margin-top: 8px;
            padding-left: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }
        
        .reference-card {
            display: inline-block;
            margin-top: 8px;
            padding: 8px 12px;
            background: #f7f6f3;
            border-radius: 6px;
            font-size: 12px;
            color: #0066FF;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reference-card:hover {
            background: #e9e9e7;
        }
        
        /* Chat Input */
        .chat-input-wrapper {
            padding: 16px;
            border-top: 1px solid #e9e9e7;
        }
        
        .chat-input-container {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }
        
        .chat-input-field {
            flex: 1;
            min-height: 40px;
            max-height: 120px;
            padding: 10px 12px;
            border: 1px solid #e9e9e7;
            border-radius: 8px;
            font-size: 14px;
            resize: none;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .chat-input-field:focus {
            border-color: #0066FF;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: #0066FF;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .send-button:hover {
            background: #0052CC;
        }
        
        .send-button:disabled {
            background: #e9e9e7;
            cursor: not-allowed;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #37352f;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .modal-close:hover {
            background: #f1f1ef;
        }
        
        /* File Tree for Documents */
        .file-tree {
            padding: 12px;
            background: #f7f6f3;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tree-item {
            padding: 4px 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .tree-item:hover {
            background: #e9e9e7;
        }
        
        .tree-folder {
            font-weight: 500;
        }
        
        .tree-file {
            margin-left: 20px;
            color: #787774;
        }
        
        /* Document Tree in Sidebar */
        .document-tree {
            margin-top: 8px;
            font-size: 13px;
        }
        
        /* Storage Progress Bar */
        .storage-progress {
            margin: 12px;
            padding: 12px;
            background: #f7f7f5;
            border-radius: 6px;
            border: 1px solid #e9e9e7;
        }
        
        .storage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .storage-title {
            font-size: 12px;
            font-weight: 600;
            color: #37352f;
        }
        
        .storage-info {
            font-size: 11px;
            color: #787774;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9e9e7;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066FF, #00D4AA);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-warning {
            background: linear-gradient(90deg, #FFA500, #FF6B6B);
        }
        
        .storage-details {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 10px;
            color: #a4a4a2;
        }
        
        /* Document sync status */
        .sync-status {
            margin-left: 4px;
            font-size: 10px;
            opacity: 0.6;
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Document artifact view */
        .artifact-panel {
            position: fixed;
            right: 20px;
            top: 80px;
            bottom: 20px;
            width: 400px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }
        
        .artifact-panel.visible {
            display: flex;
        }
        
        .artifact-header {
            padding: 16px;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .artifact-title {
            font-weight: 600;
            color: #37352f;
        }
        
        .artifact-close {
            cursor: pointer;
            padding: 4px;
            color: #787774;
        }
        
        .artifact-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
            color: #37352f;
        }
        
        .artifact-meta {
            padding: 12px 16px;
            background: #f7f7f5;
            border-top: 1px solid #e9e9e7;
            font-size: 12px;
            color: #787774;
        }
        
        /* Document Add Dropdown */
        .document-add-container {
            position: relative;
            display: inline-block;
        }
        
        .document-add-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #2383e2;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }
        
        .document-add-btn:hover {
            background: #1976d2;
        }
        
        .dropdown-arrow {
            font-size: 10px;
            transition: transform 0.2s;
        }
        
        .document-add-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .document-add-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 180px;
            z-index: 1000;
            display: none;
            margin-top: 4px;
        }
        
        .document-add-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 13px;
        }
        
        .dropdown-item:hover {
            background: #f1f1ef;
        }
        
        .dropdown-item:first-child {
            border-radius: 6px 6px 0 0;
        }
        
        .dropdown-item:last-child {
            border-radius: 0 0 6px 6px;
        }
        
        .dropdown-item span:first-child {
            font-size: 16px;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .modal-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #787774;
        }
        
        .modal-close:hover {
            background: #f1f1ef;
        }
        
        .modal-content {
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid #e9e9e7;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-primary {
            background: #2383e2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-primary:hover {
            background: #1976d2;
        }
        
        .btn-primary:disabled {
            background: #a4a4a2;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: white;
            color: #37352f;
            border: 1px solid #e9e9e7;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-secondary:hover {
            background: #f1f1ef;
        }
        
        /* Organization Document Browser */
        .org-browser-tree {
            font-size: 13px;
        }
        
        .org-folder, .org-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .org-folder:hover, .org-file:hover {
            background: #f1f1ef;
        }
        
        .org-folder-content {
            margin-left: 20px;
        }
        
        .folder-name {
            flex: 1;
        }
        
        .folder-count, .file-meta {
            color: #787774;
            font-size: 11px;
        }
        
        .file-checkbox {
            margin-right: 4px;
        }
        
        .selection-info {
            font-size: 12px;
            color: #787774;
            display: flex;
            gap: 12px;
        }
        
        /* Personal Upload Modal */
        .upload-step h4 {
            margin: 0 0 16px 0;
            font-size: 14px;
            font-weight: 600;
        }
        
        .upload-step h5 {
            margin: 0 0 8px 0;
            font-size: 13px;
            font-weight: 600;
        }
        
        .directory-selector {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .directory-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .directory-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .directory-item:hover {
            background: #f1f1ef;
            border-color: #2383e2;
        }
        
        .directory-item.selected {
            background: #e6f7ff;
            border-color: #2383e2;
        }
        
        .dir-count {
            color: #787774;
            font-size: 11px;
            margin-left: auto;
        }
        
        .selected-directory {
            background: #f7f7f5;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        
        .file-upload-area {
            border: 2px dashed #e9e9e7;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-upload-area:hover, .file-upload-area.dragover {
            border-color: #2383e2;
            background: #f8fbff;
        }
        
        .upload-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .upload-text {
            font-size: 14px;
            color: #37352f;
            margin-bottom: 8px;
        }
        
        .upload-formats {
            font-size: 12px;
            color: #787774;
        }
        
        .selected-files {
            text-align: left;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #f1f1ef;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-name {
            flex: 1;
            font-size: 13px;
        }
        
        .file-size {
            color: #787774;
            font-size: 11px;
        }
        
        /* Upload quota and validation */
        .quota-warning {
            color: #ef4444;
            font-size: 11px;
            font-weight: 600;
        }
        
        .upload-info {
            font-size: 12px;
            color: #787774;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .capacity-bar {
            width: 100%;
            height: 6px;
            background: #f1f1ef;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .capacity-fill {
            height: 100%;
            background: #2383e2;
            transition: all 0.3s ease;
        }
        
        .capacity-fill.warning {
            background: #f59e0b;
        }
        
        .capacity-fill.danger {
            background: #ef4444;
        }
        
        .validation-error {
            color: #ef4444;
            font-size: 12px;
            margin-top: 8px;
            padding: 8px;
            background: #fef2f2;
            border-radius: 4px;
            border: 1px solid #fecaca;
        }
        
        /* Stop button for chat */
        .stop-button {
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .stop-button:hover {
            background: #dc2626;
        }
        
        .doc-category {
            margin-bottom: 8px;
        }
        
        .doc-category-header {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            user-select: none;
        }
        
        .doc-category-header:hover {
            background: #e9e9e7;
        }
        
        .doc-category-icon {
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .doc-category.expanded .doc-category-icon {
            transform: rotate(90deg);
        }
        
        .doc-category-label {
            flex: 1;
            font-weight: 500;
            color: #37352f;
        }
        
        .doc-category-count {
            font-size: 11px;
            color: #a4a4a2;
            background: #f1f1ef;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .doc-category-type {
            font-size: 10px;
            color: #787774;
            margin-left: 4px;
        }
        
        .doc-items {
            display: none;
            margin-left: 12px;
            margin-top: 4px;
        }
        
        .doc-category.expanded .doc-items {
            display: block;
        }
        
        .doc-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            color: #787774;
        }
        
        .doc-item:hover {
            background: #e9e9e7;
            color: #37352f;
        }
        
        .doc-item-icon {
            font-size: 12px;
        }
        
        .doc-item-name {
            flex: 1;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .doc-folder {
            margin-bottom: 4px;
        }
        
        .doc-folder-header {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .doc-folder-header:hover {
            background: #e9e9e7;
        }
        
        .doc-folder-files {
            display: none;
            margin-left: 16px;
        }
        
        .doc-folder.expanded .doc-folder-files {
            display: block;
        }
        
        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #a4a4a2;
        }
        
        .welcome-content {
            text-align: center;
        }
        
        .welcome-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .welcome-title {
            color: #37352f;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
<div class="weraser-app">
    <!-- Header -->
    <header class="app-header">
        <div class="header-left">
            <div class="nav-icon" onclick="toggleSidebar()" title="ÏÇ¨Ïù¥ÎìúÎ∞î ÌÜ†Í∏Ä">
                <span>‚ò∞</span>
            </div>
            <div class="breadcrumb" id="breadcrumb">
                <span class="breadcrumb-current">ÌîÑÎ°úÏ†ùÌä∏</span>
            </div>
        </div>
        <div class="header-right">
            <div class="header-action" onclick="goToAdmin()">
                Í¥ÄÎ¶¨Ïûê
            </div>
            <div class="header-action" onclick="showProfile()">
                ÎÇ¥ ÌîÑÎ°úÌïÑ
            </div>
        </div>
    </header>
    
    <!-- Main Body -->
    <div class="app-body">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Dynamic content loaded here -->
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dynamic content loaded here -->
        </main>
    </div>
</div>

<!-- Removed document modal as documents are now in LNB -->

<script src="assets/shared.js"></script>
<script>
    // State management
    let currentView = 'projects'; // 'projects' or 'chats'
    let currentProject = null;
    let currentChat = null;
    let showThinkingProcess = true;
    
    // Source quota constants (in MB)
    const QUOTA_LIMITS = {
        MAX_FILE_SIZE: 50,              // Í∞úÎ≥Ñ ÌååÏùº ÏµúÎåÄ ÌÅ¨Í∏∞
        PROJECT_QUOTA: 500,             // ÌîÑÎ°úÏ†ùÌä∏Îãπ Ï¥ù Ïö©Îüâ
        USER_PERSONAL_QUOTA: 1024,      // ÏÇ¨Ïö©ÏûêÎ≥Ñ Í∞úÏù∏ Î¨∏ÏÑú Ìï†ÎãπÎüâ
        MAX_FILES_PER_PROJECT: 1000,    // ÌîÑÎ°úÏ†ùÌä∏Îãπ ÏµúÎåÄ Î¨∏ÏÑú Ïàò
        MAX_SIMULTANEOUS_UPLOAD: 10,    // ÏµúÎåÄ ÎèôÏãú ÏóÖÎ°úÎìú ÌååÏùº Ïàò
        DAILY_UPLOAD_LIMIT: 100         // ÏùºÏùº ÏóÖÎ°úÎìú ÌïúÎèÑ
    };
    
    // Warning thresholds
    const WARNING_THRESHOLDS = {
        LOW: 0.8,    // 80%
        HIGH: 0.95   // 95%
    };
    
    // Mock data for projects and chats
    let projects = [
        {
            id: 'proj1',
            name: 'H-Line ÏàòÏ∂ú ÌîÑÎ°úÏ†ùÌä∏',
            documentCount: 24,
            storage: {
                used: 124.5, // MB
                total: 500   // MB
            },
            chats: [
                { id: 'chat1', title: 'HS ÏΩîÎìú Î∂ÑÎ•ò Í≤ÄÌÜ†', lastMessage: 'Ïò¨Ìï¥ Í¥ÄÏÑ∏Ïú®ÏùÄ...', time: 'Î∞©Í∏à Ï†Ñ' },
                { id: 'chat2', title: 'Ïö¥ÏÜ° Í≤ΩÎ°ú ÏµúÏ†ÅÌôî', lastMessage: 'Î∂ÄÏÇ∞Ìï≠ Í≤ΩÏú†Ïãú...', time: '2ÏãúÍ∞Ñ Ï†Ñ' }
            ],
            documents: {
                organization: [
                    { 
                        type: 'folder', 
                        name: 'Í≥ÑÏïΩÏÑú', 
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú/Í≥ÑÏïΩÏÑú',
                        files: [
                            {
                                name: '2024_H-Line_Í≥ÑÏïΩÏÑú.pdf',
                                updateDate: '2024-08-15 14:30',
                                updater: 'ÍπÄÏ±ÖÏûÑ Í≥ºÏû•',
                                size: '2.5MB'
                            },
                            {
                                name: 'Î∂ÄÏÜçÌï©ÏùòÏÑú.docx',
                                updateDate: '2024-08-20 10:15',
                                updater: 'Ïù¥ÏÉÅÎ¨¥ ÎåÄÎ¶¨',
                                size: '1.2MB'
                            }
                        ]
                    },
                    { 
                        type: 'folder', 
                        name: 'Í¥ÄÏÑ∏ÏûêÎ£å',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú/Í¥ÄÏÑ∏ÏûêÎ£å',
                        files: [
                            {
                                name: 'HS_ÏΩîÎìú_Î∂ÑÎ•òÌëú.xlsx',
                                updateDate: '2024-07-01 09:00',
                                updater: 'Î∞ïÎ¨¥Ïó≠ Î∂ÄÏû•',
                                size: '3.8MB'
                            },
                            {
                                name: 'Í¥ÄÏÑ∏Ïú®Ìëú.pdf',
                                updateDate: '2024-07-01 09:00',
                                updater: 'Î∞ïÎ¨¥Ïó≠ Î∂ÄÏû•',
                                size: '5.2MB'
                            }
                        ]
                    },
                    { 
                        type: 'folder', 
                        name: 'Î≤ïÎ¨¥ÏûêÎ£å',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú/Î≤ïÎ¨¥ÏûêÎ£å',
                        files: [
                            {
                                name: 'ÏàòÏ∂úÏûÖÎ≤ïÎ†π.pdf',
                                updateDate: '2024-06-15 16:45',
                                updater: 'ÏµúÎ≤ïÎ¨¥ ÌåÄÏû•',
                                size: '8.9MB'
                            },
                            {
                                name: 'FTA_Í∞ÄÏù¥Îìú.pdf',
                                updateDate: '2024-06-20 11:30',
                                updater: 'ÏµúÎ≤ïÎ¨¥ ÌåÄÏû•',
                                size: '6.7MB'
                            }
                        ]
                    }
                ],
                personal: [
                    { 
                        type: 'file', 
                        name: 'ÌîÑÎ°úÏ†ùÌä∏_ÏöîÏïΩ.pptx',
                        uploadDate: '2024-08-25 13:20',
                        size: '4.5MB',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú'
                    },
                    { 
                        type: 'file', 
                        name: 'ÎØ∏ÌåÖ_ÎÖ∏Ìä∏.docx',
                        uploadDate: '2024-08-26 09:15',
                        size: '0.8MB',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú'
                    },
                    { 
                        type: 'folder', 
                        name: 'Í∞úÏù∏Î©îÎ™®',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú/Í∞úÏù∏Î©îÎ™®',
                        files: [
                            {
                                name: 'Í≤ÄÌÜ†ÏÇ¨Ìï≠.txt',
                                uploadDate: '2024-08-27 14:00',
                                size: '0.1MB'
                            },
                            {
                                name: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏.xlsx',
                                uploadDate: '2024-08-27 15:30',
                                size: '0.3MB'
                            }
                        ]
                    }
                ]
            }
        },
        {
            id: 'proj2',
            name: '2024 Ïó∞Í∞Ñ Í≥ÑÌöç',
            documentCount: 15,
            storage: {
                used: 89.2,  // MB
                total: 500   // MB
            },
            chats: [
                { id: 'chat3', title: 'Q1 Î™©Ìëú ÏÑ§Ï†ï', lastMessage: '1Î∂ÑÍ∏∞ Îß§Ï∂ú Î™©ÌëúÎäî...', time: 'Ïñ¥Ï†ú' }
            ],
            documents: {
                organization: [
                    { 
                        type: 'folder', 
                        name: 'ÌöåÏÇ¨Ï†ïÏ±Ö',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú/ÌöåÏÇ¨Ï†ïÏ±Ö',
                        files: [
                            {
                                name: 'Ïù∏ÏÇ¨Í∑úÏ†ï.pdf',
                                updateDate: '2024-01-10 10:00',
                                updater: 'Ï†ïÏù∏ÏÇ¨ Ïù¥ÏÇ¨',
                                size: '1.5MB'
                            },
                            {
                                name: 'Î≥µÎ¨¥Í∑úÏ†ï.pdf',
                                updateDate: '2024-01-10 10:00',
                                updater: 'Ï†ïÏù∏ÏÇ¨ Ïù¥ÏÇ¨',
                                size: '1.8MB'
                            }
                        ]
                    },
                    { 
                        type: 'file', 
                        name: '2024_ÏÇ¨ÏóÖÍ≥ÑÌöçÏÑú.pdf',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú',
                        updateDate: '2024-01-05 09:00',
                        updater: 'ÍπÄÍ∏∞Ìöç ÏÉÅÎ¨¥',
                        size: '12.3MB'
                    }
                ],
                personal: [
                    { 
                        type: 'folder', 
                        name: 'Î∂ÑÍ∏∞Î≥Ñ Í≥ÑÌöç',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú/Î∂ÑÍ∏∞Î≥Ñ Í≥ÑÌöç',
                        files: [
                            {
                                name: 'Q1_Í≥ÑÌöç.docx',
                                uploadDate: '2024-01-15 11:00',
                                size: '2.1MB'
                            },
                            {
                                name: 'Q2_Í≥ÑÌöç.docx',
                                uploadDate: '2024-04-01 10:30',
                                size: '2.3MB'
                            }
                        ]
                    },
                    { 
                        type: 'file', 
                        name: 'Ïó∞Í∞Ñ_Î™©Ìëú.xlsx',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú',
                        uploadDate: '2024-01-02 14:00',
                        size: '0.5MB'
                    }
                ]
            }
        },
        {
            id: 'proj3',
            name: 'Ïã†Í∑ú Í≥†Í∞ùÏÇ¨ ÎåÄÏùë',
            documentCount: 8,
            storage: {
                used: 45.8,  // MB
                total: 500   // MB
            },
            chats: [],
            documents: {
                organization: [
                    { 
                        type: 'file', 
                        name: 'ÌöåÏÇ¨ÏÜåÍ∞úÏÑú.pdf',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú',
                        updateDate: '2024-03-01 10:00',
                        updater: 'ÌôçÎ≥¥Î∂Ä ÌåÄÏû•',
                        size: '15.2MB'
                    },
                    { 
                        type: 'file', 
                        name: 'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§.pdf',
                        path: '/Ï°∞ÏßÅÎ¨∏ÏÑú',
                        updateDate: '2024-05-15 14:30',
                        updater: 'ÎîîÏûêÏù∏ÌåÄ',
                        size: '28.5MB'
                    }
                ],
                personal: [
                    { 
                        type: 'file', 
                        name: 'Ï†úÏïàÏÑú_Ï¥àÏïà.pptx',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú',
                        uploadDate: '2024-08-28 16:00',
                        size: '8.7MB'
                    },
                    { 
                        type: 'file', 
                        name: 'Í≤¨Ï†ÅÏÑú.xlsx',
                        path: '/Í∞úÏù∏Î¨∏ÏÑú',
                        uploadDate: '2024-08-28 17:30',
                        size: '0.4MB'
                    }
                ]
            }
        }
    ];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        WeraserCore.init('phase1');
        renderSidebar();
        showWelcomeScreen();
        
        // Initialize Gemini without modal
        window.NO_API_MODAL = true;
        if (typeof initializeGeminiChat === 'function') {
            initializeGeminiChat();
        }
    });
    
    // Render storage progress
    function renderStorageProgress(project) {
        if (!project || !project.storage) return '';
        
        const { used, total } = project.storage;
        const percentage = (used / total * 100).toFixed(1);
        const isWarning = percentage > 80;
        
        return `
            <div class="storage-progress">
                <div class="storage-header">
                    <div class="storage-title">üíæ Ï†ÄÏû• Í≥µÍ∞Ñ</div>
                    <div class="storage-info">${used.toFixed(1)} MB / ${total} MB (${percentage}%)</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill ${isWarning ? 'progress-warning' : ''}" style="width: ${percentage}%"></div>
                </div>
                <div class="storage-details">
                    <span>ÏÇ¨Ïö© Í∞ÄÎä•: ${(total - used).toFixed(1)} MB</span>
                    ${isWarning ? '<span style="color: #ff6b6b;">‚ö†Ô∏è Ïö©Îüâ Ï£ºÏùò</span>' : ''}
                </div>
            </div>
        `;
    }
    
    // Render document tree
    function renderDocumentTree(documents, project) {
        if (!documents) return '<div class="empty-state" style="padding: 12px; font-size: 12px;">Î¨∏ÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
        
        const orgCount = countDocuments(documents.organization);
        const personalCount = countDocuments(documents.personal);
        
        return `
            <div class="doc-category expanded" id="orgDocs">
                <div class="doc-category-header" onclick="toggleDocCategory('orgDocs')">
                    <span class="doc-category-icon">‚ñº</span>
                    <span class="doc-category-label">üè¢ Ï°∞ÏßÅ Î¨∏ÏÑú</span>
                    <span class="doc-category-count">${orgCount}</span>
                </div>
                <div class="doc-items">
                    ${renderDocumentItems(documents.organization, 'org')}
                </div>
            </div>
            <div class="doc-category" id="personalDocs">
                <div class="doc-category-header" onclick="toggleDocCategory('personalDocs')">
                    <span class="doc-category-icon">‚ñ∂</span>
                    <span class="doc-category-label">üë§ Í∞úÏù∏ Î¨∏ÏÑú</span>
                    <span class="doc-category-count">${personalCount}</span>
                </div>
                <div class="doc-items">
                    ${renderDocumentItems(documents.personal, 'personal')}
                </div>
            </div>
        `;
    }
    
    // Render document items with path
    function renderDocumentItems(items, type = 'org', basePath = '') {
        if (!items || items.length === 0) return '<div style="padding: 4px 8px; color: #a4a4a2; font-size: 11px;">ÎπÑÏñ¥ ÏûàÏùå</div>';
        
        return items.map(item => {
            const currentPath = item.path || (basePath ? `${basePath}/${item.name}` : item.name);
            
            if (item.type === 'folder') {
                return `
                    <div class="doc-folder" id="folder-${item.name}">
                        <div class="doc-folder-header" onclick="toggleDocFolder('folder-${item.name}')" title="Í≤ΩÎ°ú: ${currentPath}">
                            <span class="doc-category-icon">‚ñ∂</span>
                            <span>üìÅ</span>
                            <span class="doc-item-name">${item.name}</span>
                        </div>
                        <div class="doc-folder-files">
                            ${item.files.map(file => {
                                const fileName = typeof file === 'string' ? file : file.name;
                                const fileData = typeof file === 'object' ? file : null;
                                const filePath = `${currentPath}/${fileName}`;
                                const tooltip = type === 'org' && fileData 
                                    ? `Í≤ΩÎ°ú: ${filePath}\nÏóÖÎç∞Ïù¥Ìä∏: ${fileData.updateDate}\nÎã¥ÎãπÏûê: ${fileData.updater}`
                                    : type === 'personal' && fileData
                                    ? `Í≤ΩÎ°ú: ${filePath}\nÏóÖÎ°úÎìú: ${fileData.uploadDate}`
                                    : `Í≤ΩÎ°ú: ${filePath}`;
                                return `
                                    <div class="doc-item" onclick="selectDocument('${filePath}', '${type}', ${fileData ? `'${JSON.stringify(fileData).replace(/'/g, "&#39;").replace(/"/g, "&quot;")}'` : 'null'})" title="${tooltip}">
                                        <span class="doc-item-icon">${getFileIcon(fileName)}</span>
                                        <span class="doc-item-name">${fileName}</span>
                                        ${type === 'org' ? '<span class="sync-status" title="ÏûêÎèô ÎèôÍ∏∞Ìôî">üîÑ</span>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            } else {
                const tooltip = type === 'org' && item.updateDate
                    ? `Í≤ΩÎ°ú: ${currentPath}\nÏóÖÎç∞Ïù¥Ìä∏: ${item.updateDate}\nÎã¥ÎãπÏûê: ${item.updater}`
                    : type === 'personal' && item.uploadDate
                    ? `Í≤ΩÎ°ú: ${currentPath}\nÏóÖÎ°úÎìú: ${item.uploadDate}`
                    : `Í≤ΩÎ°ú: ${currentPath}`;
                return `
                    <div class="doc-item" onclick="selectDocument('${currentPath}', '${type}', ${item ? `'${JSON.stringify(item).replace(/'/g, "&#39;").replace(/"/g, "&quot;")}'` : 'null'})" title="${tooltip}">
                        <span class="doc-item-icon">${getFileIcon(item.name)}</span>
                        <span class="doc-item-name">${item.name}</span>
                        ${type === 'org' ? '<span class="sync-status" title="ÏûêÎèô ÎèôÍ∏∞Ìôî">üîÑ</span>' : ''}
                    </div>
                `;            
            }
        }).join('');
    }
    
    // Count documents
    function countDocuments(items) {
        if (!items) return 0;
        let count = 0;
        items.forEach(item => {
            if (item.type === 'folder') {
                count += item.files.length;
            } else {
                count += 1;
            }
        });
        return count;
    }
    
    // Get file icon based on extension
    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        const icons = {
            'pdf': 'üìï',
            'docx': 'üìÑ',
            'doc': 'üìÑ',
            'xlsx': 'üìä',
            'xls': 'üìä',
            'pptx': 'üìä',
            'ppt': 'üìä',
            'txt': 'üìù',
            'csv': 'üìä'
        };
        return icons[ext] || 'üìÑ';
    }
    
    // Toggle document category
    function toggleDocCategory(categoryId) {
        const category = document.getElementById(categoryId);
        category.classList.toggle('expanded');
    }
    
    // Toggle document folder
    function toggleDocFolder(folderId) {
        const folder = document.getElementById(folderId);
        folder.classList.toggle('expanded');
        const icon = folder.querySelector('.doc-category-icon');
        icon.textContent = folder.classList.contains('expanded') ? '‚ñº' : '‚ñ∂';
    }
    
    // Render sidebar based on current view
    function renderSidebar() {
        const sidebar = document.getElementById('sidebar');
        
        if (currentView === 'projects') {
            // Show project list
            sidebar.innerHTML = `
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <span>ÌîÑÎ°úÏ†ùÌä∏</span>
                        <button class="icon-button" onclick="createNewProject()" title="ÏÉà ÌîÑÎ°úÏ†ùÌä∏">+</button>
                    </div>
                    <div class="project-list" id="projectList">
                        ${projects.map(project => `
                            <div class="project-item" onclick="selectProject('${project.id}')">
                                <div class="project-item-header">
                                    <span class="project-icon">üìÅ</span>
                                    <span class="project-name">${project.name}</span>
                                </div>
                                <div class="project-meta">
                                    <span class="doc-count">üìÑ ${project.documentCount}Í∞ú</span>
                                    <span class="chat-count">üí¨ ${project.chats.length}Í∞ú</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        } else if (currentView === 'chats' && currentProject) {
            // Show chat list for selected project
            const project = projects.find(p => p.id === currentProject);
            sidebar.innerHTML = `
                <div class="sidebar-header">
                    <div class="back-button" onclick="backToProjects()" title="ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ùÏúºÎ°ú">
                        <span>‚Üê</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600;">${project.name}</div>
                        <div style="font-size: 12px; color: #a4a4a2;">üìÑ ${project.documentCount}Í∞ú Î¨∏ÏÑú</div>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <span>Ï±ÑÌåÖ ÏÑ∏ÏÖò</span>
                        <button class="icon-button" onclick="createNewChat('${project.id}')" title="ÏÉà Ï±ÑÌåÖ">+</button>
                    </div>
                    <div class="chat-list" id="chatList">
                        ${project.chats.length > 0 ? project.chats.map(chat => `
                            <div class="chat-item ${currentChat === chat.id ? 'active' : ''}" onclick="selectChat('${project.id}', '${chat.id}')">
                                <div class="chat-title">${chat.title}</div>
                                <div class="chat-preview">${chat.lastMessage}</div>
                                <div class="chat-time">${chat.time}</div>
                            </div>
                        `).join('') : `
                            <div class="empty-state">
                                <div style="font-size: 32px; margin-bottom: 8px;">üí¨</div>
                                <div style="font-size: 14px;">Ï±ÑÌåÖÏù¥ ÏóÜÏäµÎãàÎã§</div>
                                <button class="btn btn--primary btn--small" style="margin-top: 12px;" onclick="createNewChat('${project.id}')">Ï≤´ Ï±ÑÌåÖ ÏãúÏûë</button>
                            </div>
                        `}
                    </div>
                </div>
                <div class="sidebar-section" style="border-top: 1px solid #e9e9e7;">
                    <div class="sidebar-title">
                        <span>Î¨∏ÏÑú Í¥ÄÎ¶¨</span>
                        <div class="document-add-container">
                            <button class="document-add-btn" onclick="toggleDocumentAddMenu()" title="Î¨∏ÏÑú Ï∂îÍ∞Ä">
                                ‚ûï Î¨∏ÏÑú Ï∂îÍ∞Ä
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="document-add-dropdown" id="documentAddDropdown">
                                <div class="dropdown-item" onclick="showOrgDocumentBrowser()">
                                    <span>üìÅ</span>
                                    <span>Ï°∞ÏßÅ Î¨∏ÏÑú Î∂àÎü¨Ïò§Í∏∞</span>
                                </div>
                                <div class="dropdown-item" onclick="showPersonalUpload()">
                                    <span>üì§</span>
                                    <span>Í∞úÏù∏ Î¨∏ÏÑú ÏóÖÎ°úÎìú</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="document-tree" id="sidebarDocumentTree">
                        ${renderDocumentTree(project.documents)}
                    </div>
                </div>
            `;
        }
    }
    
    // Navigate to project's chat list
    function selectProject(projectId) {
        currentProject = projectId;
        currentView = 'chats';
        renderSidebar();
        updateBreadcrumb();
        
        // Show project welcome or last chat
        const project = projects.find(p => p.id === projectId);
        if (project.chats.length > 0) {
            selectChat(projectId, project.chats[0].id);
        } else {
            showProjectWelcome(projectId);
        }
    }
    
    // Back to project list
    function backToProjects() {
        currentView = 'projects';
        currentProject = null;
        currentChat = null;
        renderSidebar();
        updateBreadcrumb();
        showWelcomeScreen();
    }
    
    // Update breadcrumb based on current view
    function updateBreadcrumb() {
        const breadcrumb = document.getElementById('breadcrumb');
        
        if (currentView === 'projects') {
            breadcrumb.innerHTML = '<span class="breadcrumb-current">ÌîÑÎ°úÏ†ùÌä∏</span>';
        } else if (currentView === 'chats' && currentProject) {
            const project = projects.find(p => p.id === currentProject);
            const chat = currentChat ? project.chats.find(c => c.id === currentChat) : null;
            
            breadcrumb.innerHTML = `
                <span class="breadcrumb-item" onclick="backToProjects()">ÌîÑÎ°úÏ†ùÌä∏</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item" onclick="selectProject('${project.id}')">${project.name}</span>
                ${chat ? `
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">${chat.title}</span>
                ` : ''}
            `;
        }
    }
    
    // Select a chat
    function selectChat(projectId, chatId) {
        currentChat = chatId;
        
        // Update active state in sidebar
        document.querySelectorAll('.chat-item').forEach(item => {
            item.classList.remove('active');
        });
        const chatElement = event.currentTarget;
        if (chatElement && chatElement.classList) {
            chatElement.classList.add('active');
        }
        
        updateBreadcrumb();
        loadChatMessages(chatId);
    }
    
    // Show welcome screen
    function showWelcomeScreen() {
        const mainContent = document.getElementById('mainContent');
        mainContent.innerHTML = `
            <div class="welcome-screen">
                <div class="welcome-content">
                    <div class="welcome-icon">ü§ñ</div>
                    <h2 class="welcome-title">WeraserÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§</h2>
                    <p>ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî</p>
                </div>
            </div>
        `;
    }
    
    // Show project welcome
    function showProjectWelcome(projectId) {
        const project = projects.find(p => p.id === projectId);
        const mainContent = document.getElementById('mainContent');
        mainContent.innerHTML = `
            <div class="welcome-screen">
                <div class="welcome-content">
                    <div class="welcome-icon">üìÅ</div>
                    <h2 class="welcome-title">${project.name}</h2>
                    <p style="margin-bottom: 16px;">Î¨∏ÏÑú ${project.documentCount}Í∞ú Ï§ÄÎπÑÎê®</p>
                    <button class="btn btn--primary" onclick="createNewChat('${projectId}')">Ï±ÑÌåÖ ÏãúÏûëÌïòÍ∏∞</button>
                </div>
            </div>
        `;
    }
    
    // Load chat messages
    function loadChatMessages(chatId) {
        const project = projects.find(p => p.id === currentProject);
        const chat = project.chats.find(c => c.id === chatId);
        
        const mainContent = document.getElementById('mainContent');
        mainContent.innerHTML = `
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-header-title">${chat.title}</div>
                </div>
                <div class="chat-header-actions">
                    <button class="action-button" onclick="renameChat()">Ïù¥Î¶Ñ Î≥ÄÍ≤Ω</button>
                    <button class="action-button" onclick="deleteChat()">ÏÇ≠Ï†ú</button>
                    <button class="action-button ${showThinkingProcess ? 'active' : ''}" onclick="toggleThinkingMode()">
                        ÏÇ¨Í≥† Í≥ºÏ†ï
                    </button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be loaded here -->
            </div>
            <div class="chat-input-wrapper">
                <div class="chat-input-container">
                    <textarea 
                        class="chat-input-field" 
                        id="chatInput" 
                        placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                        onkeydown="handleInputKeydown(event)"
                        oninput="adjustInputHeight(this)"
                    ></textarea>
                    <button class="send-button" id="sendButton" onclick="sendMessage()">
                        ‚û§
                    </button>
                </div>
            </div>
        `;
        
        // Load sample messages
        addSampleMessages();
    }
    
    // Add sample messages
    function addSampleMessages() {
        const messagesDiv = document.getElementById('chatMessages');
        
        // Sample 1: User asks for discount rate
        const userMessage1 = createMessage('user', 'ÏûëÎÖÑ H-Line ÌîÑÎ°úÏ†ùÌä∏Ïùò ÏµúÏ¢Ö Ìï†Ïù∏Ïú®Í≥º Í∑ºÍ±∞ ÏûêÎ£åÎ•º Ï∞æÏïÑÏ§ò');
        messagesDiv.appendChild(userMessage1);
        
        // Sample 1: AI response with references
        const aiMessage1 = createMessage('ai', 
            `ÏûëÎÖÑ H-Line ÌîÑÎ°úÏ†ùÌä∏Ïùò ÏµúÏ¢Ö Ìï†Ïù∏Ïú®ÏùÄ **15%**ÏòÄÏäµÎãàÎã§.
            
            Í∑ºÍ±∞ ÏûêÎ£å:
            1. 2023ÎÖÑ 4Î∂ÑÍ∏∞ Í≥ÑÏïΩÏÑú (p.12): "ÏµúÏ¢Ö Ìï©Ïùò Ìï†Ïù∏Ïú® 15% Ï†ÅÏö©"
            2. Í∞ÄÍ≤© ÌòëÏÉÅ ÌöåÏùòÎ°ù (2023.10.15): "Í≤ΩÏüÅÏÇ¨ ÎåÄÎπÑ Ïö∞ÏúÑ ÌôïÎ≥¥Î•º ÏúÑÌïú Ï†ÑÎûµÏ†Å Ìï†Ïù∏"
            3. CFO ÏäπÏù∏ Î¨∏ÏÑú: "15% Ìï†Ïù∏ ÏäπÏù∏, Îã® ÏµúÏÜå Î¨ºÎüâ Î≥¥Ïû• Ï°∞Í±¥"`,
            true,
            ['2023_Q4_Í≥ÑÏïΩÏÑú.pdf', 'Í∞ÄÍ≤©ÌòëÏÉÅ_ÌöåÏùòÎ°ù.docx', 'CFO_ÏäπÏù∏Î¨∏ÏÑú.pdf']
        );
        messagesDiv.appendChild(aiMessage1);
        
        // Sample 2: User asks for comparison
        const userMessage2 = createMessage('user', 'ÏµúÍ∑º 3ÎÖÑÍ∞Ñ Ï£ºÏöî ÌíàÎ™©Ïùò Í¥ÄÏÑ∏Ïú® Î≥ÄÌôîÎ•º ÌëúÎ°ú Ï†ïÎ¶¨Ìï¥Ï§ò');
        messagesDiv.appendChild(userMessage2);
        
        // Sample 2: AI response with table
        const aiMessage2 = createMessage('ai', 
            `ÏµúÍ∑º 3ÎÖÑÍ∞Ñ Ï£ºÏöî ÌíàÎ™©Ïùò Í¥ÄÏÑ∏Ïú® Î≥ÄÌôîÎ•º Ï†ïÎ¶¨ÌñàÏäµÎãàÎã§:

<table style="width: 100%; border-collapse: collapse; margin: 12px 0;">
<thead>
<tr style="background: #f7f6f3;">
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: left;">ÌíàÎ™©Î™Ö</th>
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">HS ÏΩîÎìú</th>
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">2022ÎÖÑ</th>
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">2023ÎÖÑ</th>
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">2024ÎÖÑ</th>
<th style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">Î≥ÄÌôîÏú®</th>
</tr>
</thead>
<tbody>
<tr>
<td style="border: 1px solid #e9e9e7; padding: 8px;">Ï†ÑÏûêÎ∂ÄÌíà</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">8542.31</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">8%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">6%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">4%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center; color: #22c55e;">‚Üì 50%</td>
</tr>
<tr style="background: #fbfbfa;">
<td style="border: 1px solid #e9e9e7; padding: 8px;">Í∏∞Í≥ÑÎ∂ÄÌíà</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">8481.10</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">5%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">5%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">3%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center; color: #22c55e;">‚Üì 40%</td>
</tr>
<tr>
<td style="border: 1px solid #e9e9e7; padding: 8px;">ÌôîÌïôÏ†úÌíà</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">3901.10</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">6.5%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">6.5%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center;">6.5%</td>
<td style="border: 1px solid #e9e9e7; padding: 8px; text-align: center; color: #a4a4a2;">‚Üí 0%</td>
</tr>
</tbody>
</table>

**Ï£ºÏöî Î≥ÄÌôî ÏÇ¨Ìï≠:**
- FTA Ï≤¥Í≤∞Î°ú Ïù∏Ìïú Îã®Í≥ÑÏ†Å Í¥ÄÏÑ∏ Ïù∏Ìïò ÏßÑÌñâ Ï§ë
- Ï†ÑÏûêÎ∂ÄÌíàÍ≥º Í∏∞Í≥ÑÎ∂ÄÌíàÏùò Í¥ÄÏÑ∏Ïú®Ïù¥ ÌÅ¨Í≤å Í∞êÏÜå
- ÌôîÌïôÏ†úÌíàÏùÄ Î≥ÄÎèô ÏóÜÏù¥ Ïú†ÏßÄ`,
            true,
            ['Í¥ÄÏÑ∏Ïú®Ìëú_2022.xlsx', 'Í¥ÄÏÑ∏Ïú®Ìëú_2023.xlsx', 'Í¥ÄÏÑ∏Ïú®Ìëú_2024.xlsx', 'FTA_ÏòÅÌñ•Î∂ÑÏÑù.pdf']
        );
        messagesDiv.appendChild(aiMessage2);
        
        // Sample 3: User asks for trend analysis
        const userMessage3 = createMessage('user', 'Ïò¨Ìï¥ ÏÉÅÎ∞òÍ∏∞ ÏàòÏ∂ú Ïã§Ï†ÅÏùÑ Í∑∏ÎûòÌîÑÎ°ú Î≥¥Ïó¨Ï£ºÍ≥† Î∂ÑÏÑùÌï¥Ï§ò');
        messagesDiv.appendChild(userMessage3);
        
        // Sample 3: AI response with chart
        const aiMessage3 = createMessage('ai', 
            `2024ÎÖÑ ÏÉÅÎ∞òÍ∏∞ ÏàòÏ∂ú Ïã§Ï†ÅÏùÑ Î∂ÑÏÑùÌñàÏäµÎãàÎã§:

<div style="background: #f7f6f3; padding: 16px; border-radius: 8px; margin: 12px 0;">
<canvas id="exportChart" style="max-width: 100%; height: 300px;"></canvas>
</div>

**üìä ÏÉÅÎ∞òÍ∏∞ ÏàòÏ∂ú Ïã§Ï†Å Î∂ÑÏÑù**

**ÏõîÎ≥Ñ Ïã§Ï†Å (Îã®ÏúÑ: Î∞±Îßå Îã¨Îü¨)**
- 1Ïõî: $45.2M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +12%)
- 2Ïõî: $42.8M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +8%)
- 3Ïõî: $48.6M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +15%)
- 4Ïõî: $51.3M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +18%)
- 5Ïõî: $49.7M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +14%)
- 6Ïõî: $53.9M (Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ +22%)

**ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏:**
1. **ÏÑ±Ïû• Ï∂îÏÑ∏**: ÏÉÅÎ∞òÍ∏∞ Ï†ÑÏ≤¥ +14.8% ÏÑ±Ïû•
2. **ÏµúÍ≥† Ïã§Ï†Å**: 6Ïõî $53.9MÏúºÎ°ú Ïó≠ÎåÄ ÏµúÍ≥† Í∏∞Î°ù
3. **Ï£ºÏöî ÏöîÏù∏**: 
   - Ïã†Í∑ú ÏãúÏû• ÏßÑÏ∂ú (ÎèôÎÇ®ÏïÑ 3Í∞úÍµ≠)
   - Í∏∞Ï°¥ Í≥†Í∞ùÏÇ¨ Ï£ºÎ¨∏Îüâ Ï¶ùÍ∞Ä
   - ÌôòÏú® Ìö®Í≥º (+3% Í∏∞Ïó¨)

<div style="background: #e3f2fd; padding: 12px; border-left: 4px solid #0066FF; margin: 12px 0;">
üí° **Í∂åÏû• ÏÇ¨Ìï≠**: ÌïòÎ∞òÍ∏∞ÏóêÎèÑ ÏÑ±Ïû•ÏÑ∏ Ïú†ÏßÄÎ•º ÏúÑÌï¥ Ïû¨Í≥† ÌôïÎ≥¥ Î∞è Î¨ºÎ•ò ÎùºÏù∏ Ï†êÍ≤Ä ÌïÑÏöî
</div>`,
            true,
            ['ÏàòÏ∂úÏã§Ï†Å_2024_ÏÉÅÎ∞òÍ∏∞.xlsx', 'ÏãúÏû•Î∂ÑÏÑù_Î≥¥Í≥†ÏÑú.pdf', 'ÌôòÏú®ÎèôÌñ•_Î∂ÑÏÑù.pdf']
        );
        messagesDiv.appendChild(aiMessage3);
        
        // Initialize chart after message is added
        setTimeout(() => {
            const canvas = document.getElementById('exportChart');
            if (canvas && canvas.getContext) {
                drawExportChart(canvas);
            }
        }, 100);
    }
    
    // Draw export chart
    function drawExportChart(canvas) {
        const ctx = canvas.getContext('2d');
        const width = canvas.width = canvas.offsetWidth;
        const height = canvas.height = 300;
        
        // Sample data
        const data = [45.2, 42.8, 48.6, 51.3, 49.7, 53.9];
        const labels = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî'];
        const maxValue = 60;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Draw axes
        ctx.strokeStyle = '#e9e9e7';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(40, 20);
        ctx.lineTo(40, height - 40);
        ctx.lineTo(width - 20, height - 40);
        ctx.stroke();
        
        // Draw bars
        const barWidth = (width - 80) / data.length * 0.6;
        const barSpacing = (width - 80) / data.length;
        
        data.forEach((value, index) => {
            const barHeight = (value / maxValue) * (height - 80);
            const x = 40 + index * barSpacing + barSpacing * 0.2;
            const y = height - 40 - barHeight;
            
            // Bar gradient
            const gradient = ctx.createLinearGradient(0, y, 0, height - 40);
            gradient.addColorStop(0, '#0066FF');
            gradient.addColorStop(1, '#00D4AA');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(x, y, barWidth, barHeight);
            
            // Value label
            ctx.fillStyle = '#37352f';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`$${value}M`, x + barWidth / 2, y - 5);
            
            // Month label
            ctx.fillText(labels[index], x + barWidth / 2, height - 25);
        });
        
        // Y-axis labels
        ctx.fillStyle = '#787774';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'right';
        for (let i = 0; i <= 5; i++) {
            const value = (maxValue / 5) * i;
            const y = height - 40 - (i * (height - 80) / 5);
            ctx.fillText(`$${value}M`, 35, y + 4);
        }
        
        // Title
        ctx.fillStyle = '#37352f';
        ctx.font = 'bold 14px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText('2024ÎÖÑ ÏÉÅÎ∞òÍ∏∞ ÏõîÎ≥Ñ ÏàòÏ∂ú Ïã§Ï†Å', 50, 15);
    }
    
    // Create message element
    function createMessage(type, text, hasThinking = false, references = []) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message--${type}`;
        
        const now = new Date();
        const time = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        
        if (type === 'user') {
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">ÎÇò</div>
                    <div class="message-sender">ÏÇ¨Ïö©Ïûê</div>
                    <div class="message-time">${time}</div>
                </div>
                <div class="message-content">
                    <div class="message-edit-wrapper">
                        <div class="message-text" contenteditable="false">${text}</div>
                        <button class="edit-button" onclick="editMessage(this)">‚úèÔ∏è</button>
                    </div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar message-avatar--ai">AI</div>
                    <div class="message-sender">Weraser AI</div>
                    <div class="message-time">${time}</div>
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    ${hasThinking && showThinkingProcess ? `
                        <div class="thinking-process">
                            <div class="thinking-header" onclick="toggleThinking(this)">
                                <span>‚ñ∂</span>
                                <span>ÏÇ¨Í≥† Í≥ºÏ†ï</span>
                            </div>
                            <div class="thinking-content" style="display: none;">
                                1. ÏßàÎ¨∏ Î∂ÑÏÑù: "H-Line ÌîÑÎ°úÏ†ùÌä∏" + "Ìï†Ïù∏Ïú®" ÌÇ§ÏõåÎìú Ï∂îÏ∂ú<br>
                                2. Î¨∏ÏÑú Í≤ÄÏÉâ: 2023ÎÖÑ Í≥ÑÏïΩÏÑú, ÌöåÏùòÎ°ù Í≤ÄÏÉâ<br>
                                3. Ï†ïÎ≥¥ Ï∂îÏ∂ú: Ìï†Ïù∏Ïú® 15% ÌôïÏù∏<br>
                                4. ÍµêÏ∞® Í≤ÄÏ¶ù: CFO ÏäπÏù∏ Î¨∏ÏÑúÏóêÏÑú Ïû¨ÌôïÏù∏<br>
                                5. ÎãµÎ≥Ä ÏÉùÏÑ±: Ï†ïÌôïÌïú ÏàòÏπòÏôÄ Ï∂úÏ≤ò Î™ÖÏãú
                            </div>
                        </div>
                    ` : ''}
                    ${references.length > 0 ? references.map(ref => `
                        <span class="reference-card" onclick="showDocument('${ref}')">
                            üìÑ ${ref}
                        </span>
                    `).join('') : ''}
                </div>
            `;
        }
        
        return messageDiv;
    }
    
    
    // Stop AI generation
    let generationAborted = false;
    function stopGeneration() {
        generationAborted = true;
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
        
        // Add message that generation was stopped
        const messagesDiv = document.getElementById('chatMessages');
        const stoppedMessage = createMessage('ai', 'üö´ ÏÉùÏÑ±Ïù¥ Ï§ëÎã®ÎêòÏóàÏäµÎãàÎã§.', false, []);
        messagesDiv.appendChild(stoppedMessage);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    // Toggle sidebar
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('collapsed');
    }
    
    // Create new project
    function createNewProject() {
        const name = prompt('ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
        if (name) {
            const newProject = {
                id: `proj${projects.length + 1}`,
                name: name,
                documentCount: 0,
                chats: [],
                documents: []
            };
            projects.push(newProject);
            renderSidebar();
            WeraserCore.ui.showNotification(`ÌîÑÎ°úÏ†ùÌä∏ '${name}' ÏÉùÏÑ±Îê®`, 'success');
        }
    }
    
    // Create new chat
    function createNewChat(projectId) {
        const chatName = prompt('Ï±ÑÌåÖ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', 'ÏÉà Ï±ÑÌåÖ');
        if (chatName) {
            const project = projects.find(p => p.id === projectId);
            const newChat = {
                id: `chat${Date.now()}`,
                title: chatName,
                lastMessage: '',
                time: 'Î∞©Í∏à Ï†Ñ'
            };
            project.chats.push(newChat);
            
            // Update view
            currentChat = newChat.id;
            renderSidebar();
            loadChatMessages(newChat.id);
            WeraserCore.ui.showNotification(`Ï±ÑÌåÖ '${chatName}' ÏÉùÏÑ±Îê®`, 'success');
        }
    }
    
    // Message editing
    function editMessage(button) {
        const wrapper = button.closest('.message-edit-wrapper');
        const messageText = wrapper.querySelector('.message-text');
        
        if (messageText.contentEditable === 'false') {
            // Start editing
            messageText.contentEditable = 'true';
            messageText.focus();
            button.textContent = '‚úì';
            
            // Fade subsequent AI messages
            let nextMessage = wrapper.closest('.message').nextElementSibling;
            while (nextMessage) {
                if (nextMessage.classList.contains('message--ai')) {
                    nextMessage.style.opacity = '0.3';
                }
                nextMessage = nextMessage.nextElementSibling;
            }
        } else {
            // Finish editing and regenerate
            messageText.contentEditable = 'false';
            button.textContent = '‚úèÔ∏è';
            
            // Remove faded messages and regenerate AI response
            let nextMessage = wrapper.closest('.message').nextElementSibling;
            while (nextMessage && nextMessage.classList.contains('message--ai')) {
                const temp = nextMessage.nextElementSibling;
                nextMessage.remove();
                nextMessage = temp;
            }
            
            // Generate new AI response
            generateAIResponse(messageText.textContent);
        }
    }
    
    // Generate AI response
    async function generateAIResponse(message) {
        const messagesDiv = document.getElementById('chatMessages');
        
        // Use Smart Gemini with CORS detection and fallback
        if (!window.smartGemini) {
            window.smartGemini = new SmartGeminiChat();
        }
        
        // Show typing indicator with animation
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing-indicator';
        typingIndicator.innerHTML = `
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <span style="color: #787774;">Weraser AIÍ∞Ä ÎãµÎ≥ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</span>
        `;
        messagesDiv.appendChild(typingIndicator);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        
        // Get current project documents
        const project = projects.find(p => p.id === currentProject);
        const documents = project ? project.documents.map(doc => ({
            name: doc.name,
            type: doc.type || 'file',
            content: doc.content || '' // In real implementation, would load actual content
        })) : [];
        
        try {
            // Use Smart Gemini with automatic fallback
            const result = await window.smartGemini.sendMessage(message);
            
            // Remove typing indicator
            typingIndicator.remove();
            
            if (result && result.success) {
                // Create AI message with actual Gemini response
                const responseText = result.response;
                const responseTime = result.responseTime ? ` (${result.responseTime}ms)` : '';
                
                // Add warning if CORS was detected
                let finalText = responseText;
                if (result.warning) {
                    finalText += `\n\n‚ö†Ô∏è ${result.warning}`;
                }
                
                const aiMessage = createMessage('ai', 
                    finalText,
                    true,
                    []
                );
                messagesDiv.appendChild(aiMessage);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                // Show response time in console
                console.log(`Response received${responseTime}`);
            } else if (result && result.fallback) {
                // Use fallback response
                const fallbackText = result.response || 'Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÌòÑÏû¨ ÏùëÎãµÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
                const aiMessage = createMessage('ai', 
                    fallbackText + '\n\n[ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†úÎ°ú Í∏∞Î≥∏ ÏùëÎãµÏùÑ ÌëúÏãúÌï©ÎãàÎã§]',
                    false,
                    []
                );
                messagesDiv.appendChild(aiMessage);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } else {
                // Handle error
                const errorMessage = result?.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò';
                console.error('Gemini Error:', errorMessage);
                
                // Error message
                const aiMessage = createMessage('ai', 
                    `Ïò§Î•ò: ${errorMessage}`,
                    false,
                    []
                );
                messagesDiv.appendChild(aiMessage);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        } catch (error) {
            console.error('Gemini API Error:', error);
            
            // Remove typing indicator
            if (typingIndicator && typingIndicator.parentNode) {
                typingIndicator.remove();
            }
            
            // Error message
            const aiMessage = createMessage('ai', 
                `Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}\n\nAPI Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.`,
                false,
                []
            );
            messagesDiv.appendChild(aiMessage);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    }
    
    // Toggle thinking process
    function toggleThinking(element) {
        const content = element.nextElementSibling;
        const toggle = element.querySelector('span:first-child');
        
        if (content.style.display === 'none' || !content.style.display) {
            content.style.display = 'block';
            toggle.textContent = '‚ñº';
        } else {
            content.style.display = 'none';
            toggle.textContent = '‚ñ∂';
        }
    }
    
    // Toggle thinking mode
    function toggleThinkingMode() {
        showThinkingProcess = !showThinkingProcess;
        const button = event.currentTarget;
        button.classList.toggle('active');
        WeraserCore.ui.showNotification(
            showThinkingProcess ? 'ÏÇ¨Í≥† Í≥ºÏ†ï ÌëúÏãú ÏºúÏßê' : 'ÏÇ¨Í≥† Í≥ºÏ†ï ÌëúÏãú Í∫ºÏßê',
            'info'
        );
    }
    
    // Send message
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (!message) return;
        
        // Add user message
        const messagesDiv = document.getElementById('chatMessages');
        const userMessage = createMessage('user', message);
        messagesDiv.appendChild(userMessage);
        
        // Clear input
        input.value = '';
        input.style.height = 'auto';
        
        // Disable send button
        document.getElementById('sendButton').disabled = true;
        
        // Generate AI response
        await generateAIResponse(message);
        
        // Enable send button
        document.getElementById('sendButton').disabled = false;
        
        // Scroll to bottom
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    // Handle input keydown
    function handleInputKeydown(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendMessage();
        }
    }
    
    // Adjust input height
    function adjustInputHeight(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }
    
    // Upload document
    // Legacy upload function - replaced by new modal system
    function uploadDocument() {
        // Redirect to new upload system
        showPersonalUpload();
    }
    
    // Toggle document add dropdown menu
    function toggleDocumentAddMenu() {
        const dropdown = document.getElementById('documentAddDropdown');
        const button = document.querySelector('.document-add-btn');
        
        if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
            button.classList.remove('active');
        } else {
            dropdown.classList.add('show');
            button.classList.add('active');
        }
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const container = document.querySelector('.document-add-container');
        if (container && !container.contains(event.target)) {
            const dropdown = document.getElementById('documentAddDropdown');
            const button = document.querySelector('.document-add-btn');
            if (dropdown && button) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
            }
        }
    });
    
    // Show organization document browser modal
    function showOrgDocumentBrowser() {
        // Close dropdown first
        toggleDocumentAddMenu();
        
        // Create organization document browser modal
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-container" style="width: 80%; max-width: 800px; height: 70vh;">
                <div class="modal-header">
                    <h3>Ï°∞ÏßÅ Î¨∏ÏÑú Î∂àÎü¨Ïò§Í∏∞</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-content" style="height: calc(100% - 100px); overflow-y: auto;">
                    <div class="org-browser">
                        <div class="org-browser-tree">
                            <div class="org-folder expanded" onclick="toggleOrgFolder(this)">
                                <span class="folder-icon">üìÅ</span>
                                <span class="folder-name">Ï°∞ÏßÅÎ¨∏ÏÑú</span>
                                <span class="folder-count">(12Í∞ú Î¨∏ÏÑú)</span>
                            </div>
                            <div class="org-folder-content" style="margin-left: 20px;">
                                <div class="org-folder" onclick="toggleOrgFolder(this)">
                                    <span class="folder-icon">üìÇ</span>
                                    <span class="folder-name">Í≥ÑÏïΩÏÑú</span>
                                    <span class="folder-count">(3Í∞ú)</span>
                                </div>
                                <div class="org-folder-content" style="margin-left: 20px; display: none;">
                                    <div class="org-file">
                                        <input type="checkbox" class="file-checkbox">
                                        <span class="file-icon">üìÑ</span>
                                        <span class="file-name">2024_H-Line_Í≥ÑÏïΩÏÑú.pdf</span>
                                        <span class="file-meta">2.5MB ‚Ä¢ 2024-08-15</span>
                                    </div>
                                    <div class="org-file">
                                        <input type="checkbox" class="file-checkbox">
                                        <span class="file-icon">üìù</span>
                                        <span class="file-name">Î∂ÄÏÜçÌï©ÏùòÏÑú.docx</span>
                                        <span class="file-meta">1.2MB ‚Ä¢ 2024-08-20</span>
                                    </div>
                                </div>
                                <div class="org-folder" onclick="toggleOrgFolder(this)">
                                    <span class="folder-icon">üìÇ</span>
                                    <span class="folder-name">Í¥ÄÏÑ∏ÏûêÎ£å</span>
                                    <span class="folder-count">(2Í∞ú)</span>
                                </div>
                                <div class="org-folder-content" style="margin-left: 20px; display: none;">
                                    <div class="org-file">
                                        <input type="checkbox" class="file-checkbox">
                                        <span class="file-icon">üìä</span>
                                        <span class="file-name">HS_ÏΩîÎìú_Î∂ÑÎ•òÌëú.xlsx</span>
                                        <span class="file-meta">3.8MB ‚Ä¢ 2024-07-01</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="selection-info">
                        <span id="selectedCount">ÏÑ†ÌÉùÎêú Î¨∏ÏÑú: 0Í∞ú</span>
                        <span id="totalSize">Ï¥ù ÌÅ¨Í∏∞: 0MB</span>
                        <span id="orgQuotaWarning" class="quota-warning" style="display: none;">ÌîÑÎ°úÏ†ùÌä∏ Ïö©Îüâ ÌïúÎèÑ Í∑ºÏ†ë</span>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-secondary" onclick="closeModal()">Ï∑®ÏÜå</button>
                        <button class="btn-primary" id="importBtn" onclick="importSelectedDocuments()" disabled>Î∂àÎü¨Ïò§Í∏∞</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        updateSelectionInfo();
    }
    
    // Show personal document upload with directory selection
    function showPersonalUpload() {
        // Close dropdown first
        toggleDocumentAddMenu();
        
        // Create personal upload modal
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-container" style="width: 60%; max-width: 600px;">
                <div class="modal-header">
                    <h3>Í∞úÏù∏ Î¨∏ÏÑú ÏóÖÎ°úÎìú</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-content">
                    <div class="upload-step" id="directoryStep">
                        <h4>1. Ï†ÄÏû•Ìï† ÎîîÎ†âÌÜ†Î¶¨ ÏÑ†ÌÉù</h4>
                        <div class="directory-selector">
                            <div class="existing-directories">
                                <h5>Í∏∞Ï°¥ ÎîîÎ†âÌÜ†Î¶¨</h5>
                                <div class="directory-list">
                                    <div class="directory-item" onclick="selectDirectory('/Í∞úÏù∏Î¨∏ÏÑú', this)">
                                        <span class="folder-icon">üìÅ</span>
                                        <span>/Í∞úÏù∏Î¨∏ÏÑú</span>
                                        <span class="dir-count">(5Í∞ú)</span>
                                    </div>
                                    <div class="directory-item" onclick="selectDirectory('/Í∞úÏù∏Î¨∏ÏÑú/ÏûÑÏãú', this)">
                                        <span class="folder-icon">üìÅ</span>
                                        <span>/Í∞úÏù∏Î¨∏ÏÑú/ÏûÑÏãú</span>
                                        <span class="dir-count">(2Í∞ú)</span>
                                    </div>
                                    <div class="directory-item" onclick="selectDirectory('/Í∞úÏù∏Î¨∏ÏÑú/Í≥ÑÌöçÏÑú', this)">
                                        <span class="folder-icon">üìÅ</span>
                                        <span>/Í∞úÏù∏Î¨∏ÏÑú/Í≥ÑÌöçÏÑú</span>
                                        <span class="dir-count">(2Í∞ú)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="new-directory">
                                <h5>ÏÉà ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±</h5>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="newDirName" placeholder="ÎîîÎ†âÌÜ†Î¶¨ Ïù¥Î¶Ñ ÏûÖÎ†•" 
                                           style="flex: 1; padding: 8px; border: 1px solid #e9e9e7; border-radius: 4px;">
                                    <button class="btn-secondary" onclick="createNewDirectory()">ÏÉùÏÑ±</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="upload-step" id="fileStep" style="display: none;">
                        <h4>2. ÌååÏùº ÏÑ†ÌÉù Î∞è ÏóÖÎ°úÎìú</h4>
                        <div class="selected-directory">
                            ÏÑ†ÌÉùÎêú ÎîîÎ†âÌÜ†Î¶¨: <span id="selectedDirPath"></span>
                        </div>
                        <div class="file-upload-area" onclick="triggerFileSelect()" 
                             ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÎÜìÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                            <div class="upload-formats">ÏßÄÏõê ÌòïÏãù: PDF, Word, Excel, PPT, Ïù¥ÎØ∏ÏßÄ, ÌÖçÏä§Ìä∏</div>
                        </div>
                        <input type="file" id="fileInput" multiple accept=".pdf,.docx,.xlsx,.csv,.txt,.pptx,.png,.jpg,.jpeg" 
                               style="display: none;" onchange="handleFileSelect(event)">
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="upload-info" id="uploadInfo" style="display: none;">
                        <span id="fileCount">ÌååÏùº: 0Í∞ú</span>
                        <span id="totalUploadSize">ÌÅ¨Í∏∞: 0MB</span>
                        <span id="quotaWarning" class="quota-warning" style="display: none;">Ïö©Îüâ ÌïúÎèÑ Í∑ºÏ†ë</span>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-secondary" onclick="closeModal()">Ï∑®ÏÜå</button>
                        <button class="btn-primary" id="selectBtn" onclick="confirmDirectorySelection()" style="display: none;">ÏÑ†ÌÉù</button>
                        <button class="btn-primary" id="nextBtn" onclick="nextStep()" disabled>Îã§Ïùå</button>
                        <button class="btn-primary" id="uploadBtn" onclick="executeUpload()" style="display: none;" disabled>ÏóÖÎ°úÎìú</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
    }
    
    // Quota and validation functions
    function calculateCurrentUsage(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (!project) return { size: 0, count: 0 };
        
        let totalSize = 0;
        let totalCount = 0;
        
        // Calculate organization documents
        if (project.documents.organization) {
            project.documents.organization.forEach(item => {
                if (item.type === 'file') {
                    totalSize += parseFloat(item.size?.replace('MB', '') || 0);
                    totalCount++;
                } else if (item.files) {
                    item.files.forEach(file => {
                        totalSize += parseFloat(file.size?.replace('MB', '') || 0);
                        totalCount++;
                    });
                }
            });
        }
        
        // Calculate personal documents
        if (project.documents.personal) {
            project.documents.personal.forEach(item => {
                if (item.type === 'file') {
                    totalSize += parseFloat(item.size?.replace('MB', '') || 0);
                    totalCount++;
                } else if (item.files) {
                    item.files.forEach(file => {
                        totalSize += parseFloat(file.size?.replace('MB', '') || 0);
                        totalCount++;
                    });
                }
            });
        }
        
        return { size: totalSize, count: totalCount };
    }
    
    function validateFileUpload(files, projectId) {
        const errors = [];
        const warnings = [];
        
        // Check file count limit
        if (files.length > QUOTA_LIMITS.MAX_SIMULTANEOUS_UPLOAD) {
            errors.push(`ÏµúÎåÄ ${QUOTA_LIMITS.MAX_SIMULTANEOUS_UPLOAD}Í∞ú ÌååÏùºÎßå ÎèôÏãúÏóê ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§. (ÌòÑÏû¨: ${files.length}Í∞ú)`);
        }
        
        // Check individual file sizes and formats
        let totalNewSize = 0;
        const allowedFormats = ['.pdf', '.docx', '.xlsx', '.csv', '.txt', '.pptx', '.png', '.jpg', '.jpeg'];
        
        Array.from(files).forEach((file, index) => {
            const fileSizeMB = file.size / (1024 * 1024);
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            
            // File size check
            if (fileSizeMB > QUOTA_LIMITS.MAX_FILE_SIZE) {
                errors.push(`ÌååÏùº "${file.name}"Ïùò ÌÅ¨Í∏∞Í∞Ä ${QUOTA_LIMITS.MAX_FILE_SIZE}MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§. (${fileSizeMB.toFixed(1)}MB)`);
            }
            
            // Format check
            if (!allowedFormats.includes(fileExt)) {
                errors.push(`ÌååÏùº "${file.name}"ÏùÄ(Îäî) ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌòïÏãùÏûÖÎãàÎã§. ÏßÄÏõê ÌòïÏãù: ${allowedFormats.join(', ')}`);
            }
            
            totalNewSize += fileSizeMB;
        });
        
        // Check project quota
        const currentUsage = calculateCurrentUsage(projectId);
        const newTotalSize = currentUsage.size + totalNewSize;
        const quotaUsage = newTotalSize / QUOTA_LIMITS.PROJECT_QUOTA;
        
        if (newTotalSize > QUOTA_LIMITS.PROJECT_QUOTA) {
            errors.push(`ÌîÑÎ°úÏ†ùÌä∏ Ïö©Îüâ ÌïúÎèÑÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§. (ÌòÑÏû¨: ${currentUsage.size.toFixed(1)}MB, Ï∂îÍ∞Ä: ${totalNewSize.toFixed(1)}MB, ÌïúÎèÑ: ${QUOTA_LIMITS.PROJECT_QUOTA}MB)`);
        } else if (quotaUsage >= WARNING_THRESHOLDS.HIGH) {
            warnings.push(`ÌîÑÎ°úÏ†ùÌä∏ Ïö©ÎüâÏùò ${(quotaUsage * 100).toFixed(0)}%Î•º ÏÇ¨Ïö©ÌïòÍ≤å Îê©ÎãàÎã§. Ïö©Îüâ Ï†ïÎ¶¨Î•º Í∂åÏû•Ìï©ÎãàÎã§.`);
        } else if (quotaUsage >= WARNING_THRESHOLDS.LOW) {
            warnings.push(`ÌîÑÎ°úÏ†ùÌä∏ Ïö©ÎüâÏùò ${(quotaUsage * 100).toFixed(0)}%Î•º ÏÇ¨Ïö©ÌïòÍ≤å Îê©ÎãàÎã§.`);
        }
        
        // Check file count
        const newTotalCount = currentUsage.count + files.length;
        if (newTotalCount > QUOTA_LIMITS.MAX_FILES_PER_PROJECT) {
            errors.push(`ÌîÑÎ°úÏ†ùÌä∏Îãπ ÏµúÎåÄ ${QUOTA_LIMITS.MAX_FILES_PER_PROJECT}Í∞ú Î¨∏ÏÑúÎßå Ï†ÄÏû•Ìï† Ïàò ÏûàÏäµÎãàÎã§. (ÌòÑÏû¨: ${currentUsage.count}Í∞ú, Ï∂îÍ∞Ä: ${files.length}Í∞ú)`);
        }
        
        return { 
            valid: errors.length === 0, 
            errors, 
            warnings, 
            newSize: totalNewSize,
            totalSize: newTotalSize,
            quotaUsage: quotaUsage
        };
    }
    
    function updateCapacityDisplay(projectId) {
        const usage = calculateCurrentUsage(projectId);
        const percentage = (usage.size / QUOTA_LIMITS.PROJECT_QUOTA) * 100;
        
        // Update sidebar capacity bar
        const capacityFill = document.querySelector('.capacity-used');
        const capacityText = document.querySelector('.capacity-text');
        
        if (capacityFill && capacityText) {
            capacityFill.style.width = Math.min(percentage, 100) + '%';
            capacityText.textContent = `${usage.size.toFixed(1)}MB / ${QUOTA_LIMITS.PROJECT_QUOTA}MB`;
            
            // Update color based on usage
            capacityFill.className = 'capacity-used';
            if (percentage >= WARNING_THRESHOLDS.HIGH * 100) {
                capacityFill.classList.add('danger');
            } else if (percentage >= WARNING_THRESHOLDS.LOW * 100) {
                capacityFill.classList.add('warning');
            }
        }
    }
    
    // Modal helper functions
    function closeModal() {
        const modal = document.querySelector('.modal-overlay');
        if (modal) {
            modal.remove();
        }
    }
    
    // Organization document browser functions
    function toggleOrgFolder(element) {
        const content = element.nextElementSibling;
        if (content && content.classList.contains('org-folder-content')) {
            const isExpanded = content.style.display !== 'none';
            content.style.display = isExpanded ? 'none' : 'block';
            
            const icon = element.querySelector('.folder-icon');
            icon.textContent = isExpanded ? 'üìÇ' : 'üìÅ';
        }
    }
    
    function updateSelectionInfo() {
        const checkboxes = document.querySelectorAll('.file-checkbox:checked');
        const count = checkboxes.length;
        let totalSize = 0;
        
        checkboxes.forEach(checkbox => {
            const fileElement = checkbox.closest('.org-file');
            const metaText = fileElement.querySelector('.file-meta').textContent;
            const sizeMatch = metaText.match(/([\d.]+)MB/);
            if (sizeMatch) {
                totalSize += parseFloat(sizeMatch[1]);
            }
        });
        
        const countElement = document.getElementById('selectedCount');
        const sizeElement = document.getElementById('totalSize');
        const warningElement = document.getElementById('orgQuotaWarning');
        const importBtn = document.getElementById('importBtn');
        
        if (countElement) countElement.textContent = `ÏÑ†ÌÉùÎêú Î¨∏ÏÑú: ${count}Í∞ú`;
        if (sizeElement) sizeElement.textContent = `Ï¥ù ÌÅ¨Í∏∞: ${totalSize.toFixed(1)}MB`;
        
        // Check quota and update warning
        const currentUsage = calculateCurrentUsage(currentProject);
        const newTotalSize = currentUsage.size + totalSize;
        const quotaUsage = newTotalSize / QUOTA_LIMITS.PROJECT_QUOTA;
        
        if (warningElement) {
            if (quotaUsage >= WARNING_THRESHOLDS.HIGH) {
                warningElement.textContent = `Ïö©Îüâ ÌïúÎèÑ ${(quotaUsage * 100).toFixed(0)}% ÏÇ¨Ïö© - Ï†ïÎ¶¨ ÌïÑÏöî`;
                warningElement.style.display = 'inline';
            } else if (quotaUsage >= WARNING_THRESHOLDS.LOW) {
                warningElement.textContent = `Ïö©Îüâ ÌïúÎèÑ ${(quotaUsage * 100).toFixed(0)}% ÏÇ¨Ïö©`;
                warningElement.style.display = 'inline';
            } else {
                warningElement.style.display = 'none';
            }
        }
        
        // Enable/disable import button
        if (importBtn) {
            const canImport = count > 0 && newTotalSize <= QUOTA_LIMITS.PROJECT_QUOTA;
            importBtn.disabled = !canImport;
        }
        
        // Add event listeners to checkboxes
        document.querySelectorAll('.file-checkbox').forEach(checkbox => {
            checkbox.removeEventListener('change', updateSelectionInfo);
            checkbox.addEventListener('change', updateSelectionInfo);
        });
    }
    
    function importSelectedDocuments() {
        const checkboxes = document.querySelectorAll('.file-checkbox:checked');
        const selectedFiles = [];
        
        checkboxes.forEach(checkbox => {
            const fileElement = checkbox.closest('.org-file');
            const fileName = fileElement.querySelector('.file-name').textContent;
            selectedFiles.push(fileName);
        });
        
        if (selectedFiles.length === 0) {
            WeraserCore.ui.showNotification('ÏÑ†ÌÉùÎêú Î¨∏ÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§', 'warning');
            return;
        }
        
        WeraserCore.ui.showNotification(`${selectedFiles.length}Í∞ú Ï°∞ÏßÅ Î¨∏ÏÑú Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å`, 'success');
        closeModal();
        
        // Update sidebar to show imported documents
        const project = projects.find(p => p.id === currentProject);
        if (project) {
            renderSidebar();
        }
    }
    
    // Personal upload functions
    let selectedDirectory = '';
    
    function selectDirectory(dirPath, element) {
        selectedDirectory = dirPath;
        
        // Update UI to show selected directory
        document.querySelectorAll('.directory-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        // Use provided element or try to get from event
        const targetElement = element || (window.event && window.event.target ? window.event.target.closest('.directory-item') : null);
        if (targetElement) {
            targetElement.classList.add('selected');
        }
        
        // Enable next button
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) {
            nextBtn.disabled = false;
        }
    }
    
    function createNewDirectory() {
        const input = document.getElementById('newDirName');
        const dirName = input.value.trim();
        
        if (!dirName) {
            WeraserCore.ui.showNotification('ÎîîÎ†âÌÜ†Î¶¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'warning');
            return;
        }
        
        const fullPath = `/Í∞úÏù∏Î¨∏ÏÑú/${dirName}`;
        selectedDirectory = fullPath;
        
        // Add new directory to list
        const dirList = document.querySelector('.directory-list');
        const newDirElement = document.createElement('div');
        newDirElement.className = 'directory-item selected';
        newDirElement.onclick = () => selectDirectory(fullPath, newDirElement);
        newDirElement.innerHTML = `
            <span class="folder-icon">üìÅ</span>
            <span>${fullPath}</span>
            <span class="dir-count">(0Í∞ú)</span>
        `;
        
        dirList.appendChild(newDirElement);
        
        // Clear other selections
        document.querySelectorAll('.directory-item').forEach(item => {
            if (item !== newDirElement) {
                item.classList.remove('selected');
            }
        });
        
        // Enable next button and clear input
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) {
            nextBtn.disabled = false;
        }
        input.value = '';
        
        WeraserCore.ui.showNotification(`ÎîîÎ†âÌÜ†Î¶¨ "${dirName}" ÏÉùÏÑ± ÏôÑÎ£å`, 'success');
    }
    
    function nextStep() {
        if (!selectedDirectory) {
            WeraserCore.ui.showNotification('ÎîîÎ†âÌÜ†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'warning');
            return;
        }
        
        // Hide directory step, show file step
        document.getElementById('directoryStep').style.display = 'none';
        document.getElementById('fileStep').style.display = 'block';
        document.getElementById('selectedDirPath').textContent = selectedDirectory;
        
        // Update buttons
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('uploadBtn').style.display = 'inline-block';
    }
    
    function triggerFileSelect() {
        document.getElementById('fileInput').click();
    }
    
    function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.classList.add('dragover');
    }
    
    function handleFileDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.remove('dragover');
        const files = event.dataTransfer.files;
        handleFiles(files);
    }
    
    function handleFileSelect(event) {
        const files = event.target.files;
        handleFiles(files);
    }
    
    function handleFiles(files) {
        if (files.length === 0) return;
        
        // Validate files
        const validation = validateFileUpload(files, currentProject);
        
        // Update upload area to show selected files
        const uploadArea = document.querySelector('.file-upload-area');
        let validationHTML = '';
        
        if (validation.errors.length > 0) {
            validationHTML += `
                <div class="validation-error">
                    <strong>ÏóÖÎ°úÎìú Î∂àÍ∞Ä:</strong><br>
                    ${validation.errors.map(error => `‚Ä¢ ${error}`).join('<br>')}
                </div>
            `;
        }
        
        if (validation.warnings.length > 0) {
            validationHTML += `
                <div style="color: #f59e0b; font-size: 12px; margin-top: 8px; padding: 8px; background: #fffbeb; border-radius: 4px; border: 1px solid #fed7aa;">
                    <strong>Ï£ºÏùò:</strong><br>
                    ${validation.warnings.map(warning => `‚Ä¢ ${warning}`).join('<br>')}
                </div>
            `;
        }
        
        uploadArea.innerHTML = `
            <div class="selected-files">
                <h5>ÏÑ†ÌÉùÎêú ÌååÏùº (${files.length}Í∞ú)</h5>
                ${Array.from(files).map(file => `
                    <div class="file-item">
                        <span class="file-icon">${getFileIcon(file.name)}</span>
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">${(file.size / (1024 * 1024)).toFixed(1)}MB</span>
                    </div>
                `).join('')}
                ${validationHTML}
                <button class="btn-secondary" onclick="resetFileSelection()" style="margin-top: 10px;">Îã§Ïãú ÏÑ†ÌÉù</button>
            </div>
        `;
        
        // Update upload info
        const uploadInfo = document.getElementById('uploadInfo');
        const fileCount = document.getElementById('fileCount');
        const totalUploadSize = document.getElementById('totalUploadSize');
        const quotaWarning = document.getElementById('quotaWarning');
        
        if (uploadInfo) uploadInfo.style.display = 'flex';
        if (fileCount) fileCount.textContent = `ÌååÏùº: ${files.length}Í∞ú`;
        if (totalUploadSize) totalUploadSize.textContent = `ÌÅ¨Í∏∞: ${validation.newSize.toFixed(1)}MB`;
        
        if (quotaWarning) {
            if (validation.quotaUsage >= WARNING_THRESHOLDS.HIGH) {
                quotaWarning.textContent = `Ïö©Îüâ ÌïúÎèÑ ${(validation.quotaUsage * 100).toFixed(0)}% ÏÇ¨Ïö©`;
                quotaWarning.style.display = 'inline';
            } else if (validation.quotaUsage >= WARNING_THRESHOLDS.LOW) {
                quotaWarning.textContent = `Ïö©Îüâ ÌïúÎèÑ ${(validation.quotaUsage * 100).toFixed(0)}% ÏÇ¨Ïö©`;
                quotaWarning.style.display = 'inline';
            } else {
                quotaWarning.style.display = 'none';
            }
        }
        
        // Enable/disable upload button
        const uploadBtn = document.getElementById('uploadBtn');
        if (uploadBtn) {
            uploadBtn.disabled = !validation.valid;
        }
    }
    
    function resetFileSelection() {
        const uploadArea = document.querySelector('.file-upload-area');
        uploadArea.innerHTML = `
            <div class="upload-icon">üì§</div>
            <div class="upload-text">ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÎÜìÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
            <div class="upload-formats">ÏßÄÏõê ÌòïÏãù: PDF, Word, Excel, PPT, Ïù¥ÎØ∏ÏßÄ, ÌÖçÏä§Ìä∏</div>
        `;
        
        uploadArea.onclick = triggerFileSelect;
        
        // Disable upload button
        const uploadBtn = document.getElementById('uploadBtn');
        if (uploadBtn) {
            uploadBtn.disabled = true;
        }
        
        // Reset file input
        document.getElementById('fileInput').value = '';
    }
    
    function executeUpload() {
        const files = document.getElementById('fileInput').files;
        if (!files || files.length === 0) {
            WeraserCore.ui.showNotification('ÏóÖÎ°úÎìúÌï† ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'warning');
            return;
        }
        
        // Final validation
        const validation = validateFileUpload(files, currentProject);
        if (!validation.valid) {
            WeraserCore.ui.showNotification('ÏóÖÎ°úÎìú Ï°∞Í±¥ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            return;
        }
        
        WeraserCore.ui.showNotification(`${files.length}Í∞ú ÌååÏùºÏùÑ ${selectedDirectory}Ïóê ÏóÖÎ°úÎìú Ï§ë...`, 'info');
        
        // Simulate upload process and actually add to project data
        setTimeout(() => {
            const project = projects.find(p => p.id === currentProject);
            if (project) {
                // Initialize personal documents array if not exists
                if (!project.documents.personal) {
                    project.documents.personal = [];
                }
                
                // Check if directory folder exists, create if not
                let directoryFolder = project.documents.personal.find(item => 
                    item.type === 'folder' && item.path === selectedDirectory
                );
                
                if (!directoryFolder) {
                    directoryFolder = {
                        type: 'folder',
                        name: selectedDirectory.split('/').pop(),
                        path: selectedDirectory,
                        files: []
                    };
                    project.documents.personal.push(directoryFolder);
                }
                
                // Add files to directory
                Array.from(files).forEach(file => {
                    const fileData = {
                        name: file.name,
                        size: (file.size / (1024 * 1024)).toFixed(1) + 'MB',
                        uploadDate: new Date().toISOString().slice(0, 16).replace('T', ' '),
                        type: file.type || 'application/octet-stream'
                    };
                    
                    directoryFolder.files.push(fileData);
                });
                
                // Update document count
                project.documentCount += files.length;
                
                WeraserCore.ui.showNotification(`${files.length}Í∞ú Í∞úÏù∏ Î¨∏ÏÑú ÏóÖÎ°úÎìú ÏôÑÎ£å`, 'success');
                
                // Update capacity display and sidebar
                updateCapacityDisplay(currentProject);
                renderSidebar();
            }
            
            closeModal();
        }, 1500);
    }
    
    // Select document and show artifact view
    function selectDocument(path, type, metadataStr) {
        console.log('selectDocument called with:', path, type, metadataStr);
        const project = projects.find(p => p.id === currentProject);
        if (!project) {
            console.log('No project found');
            return;
        }
        
        // Parse metadata if provided
        let metadata = null;
        if (metadataStr) {
            try {
                metadata = JSON.parse(metadataStr.replace(/&#39;/g, "'").replace(/&quot;/g, '"'));
                console.log('Parsed metadata:', metadata);
            } catch (e) {
                console.error('Failed to parse metadata:', e);
            }
        }
        
        // Show artifact panel
        console.log('Calling showArtifactPanel...');
        showArtifactPanel(path, type, metadata);
        
        // Highlight selected document
        document.querySelectorAll('.doc-item').forEach(item => {
            item.classList.remove('selected');
        });
        if (event && event.currentTarget) {
            event.currentTarget.classList.add('selected');
        }
    }
    
    // Show artifact panel
    function showArtifactPanel(documentPath, documentType, metadata) {
        console.log('showArtifactPanel called with:', documentPath, documentType, metadata);
        // Remove existing panel if any
        let panel = document.querySelector('.artifact-panel');
        if (!panel) {
            console.log('Creating new artifact panel');
            panel = document.createElement('div');
            panel.className = 'artifact-panel';
            document.body.appendChild(panel);
        } else {
            console.log('Using existing panel');
        }
        
        // Get file name and extension
        const fileName = documentPath.split('/').pop();
        const fileExt = fileName.split('.').pop().toUpperCase();
        
        // Build metadata section
        let metaSection = '';
        if (metadata) {
            metaSection = `
                <h4>üìä Î©îÌÉÄÏ†ïÎ≥¥</h4>
                <table style="width: 100%; font-size: 13px; margin: 10px 0;">
                    ${metadata.updateDate ? `
                        <tr>
                            <td style="padding: 6px; color: #787774; width: 30%;">ÏóÖÎç∞Ïù¥Ìä∏ ÏùºÏãú:</td>
                            <td style="padding: 6px;">${metadata.updateDate}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; color: #787774;">ÏóÖÎç∞Ïù¥Ìä∏ Îã¥ÎãπÏûê:</td>
                            <td style="padding: 6px;">${metadata.updater}</td>
                        </tr>
                    ` : ''}
                    ${metadata.uploadDate ? `
                        <tr>
                            <td style="padding: 6px; color: #787774; width: 30%;">ÏóÖÎ°úÎìú ÏùºÏãú:</td>
                            <td style="padding: 6px;">${metadata.uploadDate}</td>
                        </tr>
                    ` : ''}
                    ${metadata.size ? `
                        <tr>
                            <td style="padding: 6px; color: #787774;">ÌååÏùº ÌÅ¨Í∏∞:</td>
                            <td style="padding: 6px;">${metadata.size}</td>
                        </tr>
                    ` : ''}
                    <tr>
                        <td style="padding: 6px; color: #787774;">Î¨∏ÏÑú Ïú†Ìòï:</td>
                        <td style="padding: 6px;">${getFileIcon(fileName)} ${fileExt}</td>
                    </tr>
                </table>
            `;
        }
        
        // Mock document content
        const mockDocumentContent = `
            <h4>üìÑ Î¨∏ÏÑú ÎÇ¥Ïö©</h4>
            <div style="background: #f7f7f5; padding: 15px; border-radius: 6px; margin: 10px 0; font-size: 14px; line-height: 1.8;">
                ${documentPath.includes('Í≥ÑÏïΩ') ? `
                    <p><strong>1. Í≥ÑÏïΩ Í∞úÏöî</strong></p>
                    <p>‚Ä¢ Í≥ÑÏïΩÎ™Ö: H-Line ÏàòÏ∂ú Í≥µÍ∏â Í≥ÑÏïΩ</p>
                    <p>‚Ä¢ Í≥ÑÏïΩÍ∏∞Í∞Ñ: 2024.01.01 ~ 2024.12.31</p>
                    <p>‚Ä¢ Í≥ÑÏïΩÍ∏àÏï°: USD 5,000,000</p>
                    <br>
                    <p><strong>2. Ï£ºÏöî Ï°∞Ìï≠</strong></p>
                    <p>‚Ä¢ ÎÇ©Ìíà ÏùºÏ†ï: Î∂ÑÍ∏∞Î≥Ñ ÎÇòÎàÑÏñ¥ ÎÇ©Ìíà</p>
                    <p>‚Ä¢ ÌíàÏßà Î≥¥Ï¶ù: ISO 9001 Í∏∞Ï§Ä Ï∂©Ï°±</p>
                    <p>‚Ä¢ Í≤∞Ï†ú Ï°∞Í±¥: L/C at sight</p>
                ` : documentPath.includes('Í¥ÄÏÑ∏') ? `
                    <p><strong>HS ÏΩîÎìú Î∂ÑÎ•ò Ï≤¥Í≥Ñ</strong></p>
                    <p>‚Ä¢ 8708.99: Í∏∞ÌÉÄ ÏûêÎèôÏ∞® Î∂ÄÌíà - Í¥ÄÏÑ∏Ïú® 8%</p>
                    <p>‚Ä¢ 8708.30: Î∏åÎ†àÏù¥ÌÅ¨ Î∞è ÏÑúÎ≥¥Î∏åÎ†àÏù¥ÌÅ¨ - Í¥ÄÏÑ∏Ïú® 8%</p>
                    <p>‚Ä¢ 8708.40: Í∏∞Ïñ¥Î∞ïÏä§ - Í¥ÄÏÑ∏Ïú® 8%</p>
                    <br>
                    <p><strong>FTA ÌôúÏö© Ïãú ÌòúÌÉù</strong></p>
                    <p>‚Ä¢ Ìïú-EU FTA: Ï¶âÏãú Ï≤†Ìèê ÎòêÎäî 5ÎÖÑ ÎÇ¥ Îã®Í≥ÑÏ†Å Ï≤†Ìèê</p>
                    <p>‚Ä¢ Ìïú-ÎØ∏ FTA: Ï¶âÏãú Ï≤†Ìèê ÎòêÎäî 5ÎÖÑ ÎÇ¥ Îã®Í≥ÑÏ†Å Ï≤†Ìèê</p>
                ` : documentPath.includes('Î≤ïÎ¨¥') ? `
                    <p><strong>ÏàòÏ∂úÏûÖ Í¥ÄÎ†® Ï£ºÏöî Î≤ïÎ†π</strong></p>
                    <p>‚Ä¢ ÎåÄÏô∏Î¨¥Ïó≠Î≤ï: ÏàòÏ∂úÏûÖ Í∏∞Î≥∏ Î≤ïÎ†π</p>
                    <p>‚Ä¢ Í¥ÄÏÑ∏Î≤ï: Í¥ÄÏÑ∏ Î∂ÄÍ≥º Î∞è ÏßïÏàò</p>
                    <p>‚Ä¢ Ïô∏Íµ≠ÌôòÍ±∞ÎûòÎ≤ï: Ïô∏Ìôò Í±∞Îûò Í∑úÏ†ï</p>
                    <br>
                    <p><strong>FTA ÌôúÏö© Í∞ÄÏù¥Îìú</strong></p>
                    <p>‚Ä¢ ÏõêÏÇ∞ÏßÄ Í≤∞Ï†ï Í∏∞Ï§Ä</p>
                    <p>‚Ä¢ ÏõêÏÇ∞ÏßÄ Ï¶ùÎ™ÖÏÑú Î∞úÍ∏â Ï†àÏ∞®</p>
                    <p>‚Ä¢ FTAÎ≥Ñ ÌäπÌòú Í¥ÄÏÑ∏Ïú®</p>
                ` : `
                    <p>Ïù¥ Î¨∏ÏÑúÏùò ÏÉÅÏÑ∏ ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>
                    <p>Ïã§Ï†ú ÏãúÏä§ÌÖúÏóêÏÑúÎäî Î¨∏ÏÑúÏùò Ï†ÑÏ≤¥ ÎÇ¥Ïö©Ïù¥ ÌëúÏãúÎêòÎ©∞,</p>
                    <p>ÌÖçÏä§Ìä∏ Í≤ÄÏÉâ Î∞è ÌïòÏù¥ÎùºÏù¥Ìä∏ Í∏∞Îä•Ïù¥ Ï†úÍ≥µÎê©ÎãàÎã§.</p>
                `}
            </div>
        `;
        
        const mockContent = `
            <h3>üìÑ ${fileName}</h3>
            <p><strong>Í≤ΩÎ°ú:</strong> ${documentPath}</p>
            <hr style="margin: 16px 0; border: none; border-top: 1px solid #e9e9e7;">
            ${metaSection}
            ${mockDocumentContent}
            <h4>üéØ ÌÇ§ÏõåÎìú</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                <span style="padding: 4px 8px; background: #e6f7ff; border-radius: 4px; font-size: 12px;">ÏàòÏ∂ú</span>
                <span style="padding: 4px 8px; background: #e6f7ff; border-radius: 4px; font-size: 12px;">Í≥ÑÏïΩ</span>
                <span style="padding: 4px 8px; background: #e6f7ff; border-radius: 4px; font-size: 12px;">H-Line</span>
                <span style="padding: 4px 8px; background: #e6f7ff; border-radius: 4px; font-size: 12px;">2024</span>
            </div>
        `;
        
        panel.innerHTML = `
            <div class="artifact-header">
                <div class="artifact-title">Î¨∏ÏÑú ÏÉÅÏÑ∏</div>
                <div class="artifact-close" onclick="closeArtifactPanel()">‚úï</div>
            </div>
            <div class="artifact-content">
                ${mockContent}
            </div>
            <div class="artifact-meta">
                ${documentType === 'org' ? 'üîÑ ÏûêÎèô ÎèôÍ∏∞Ìôî ÌôúÏÑ±' : 'üë§ Í∞úÏù∏ Î¨∏ÏÑú'} | 
                ${metadata ? (metadata.updateDate || metadata.uploadDate || 'ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: Î∞©Í∏à Ï†Ñ') : 'ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: Î∞©Í∏à Ï†Ñ'}
            </div>
        `;
        
        console.log('Adding visible class to panel');
        panel.classList.add('visible');
        console.log('Panel classes:', panel.className);
    }
    
    // Close artifact panel
    function closeArtifactPanel() {
        const panel = document.querySelector('.artifact-panel');
        if (panel) {
            panel.classList.remove('visible');
        }
    }
    
    // Show document
    function showDocument(filename) {
        WeraserCore.ui.showNotification(`Î¨∏ÏÑú '${filename}' Ïó¥Í∏∞`, 'info');
        // TODO: Open document viewer
    }
    
    // Legacy closeModal function - replaced by modal overlay system
    // (removed to prevent conflicts)
    
    // Rename chat
    function renameChat() {
        const project = projects.find(p => p.id === currentProject);
        const chat = project.chats.find(c => c.id === currentChat);
        const newName = prompt('ÏÉà Ï±ÑÌåÖ Ïù¥Î¶Ñ:', chat.title);
        if (newName && newName !== chat.title) {
            chat.title = newName;
            renderSidebar();
            updateBreadcrumb();
            WeraserCore.ui.showNotification('Ï±ÑÌåÖ Ïù¥Î¶Ñ Î≥ÄÍ≤ΩÎê®', 'success');
        }
    }
    
    // Delete chat
    function deleteChat() {
        if (confirm('Ïù¥ Ï±ÑÌåÖÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
            const project = projects.find(p => p.id === currentProject);
            const chatIndex = project.chats.findIndex(c => c.id === currentChat);
            project.chats.splice(chatIndex, 1);
            
            // Show welcome or first chat
            if (project.chats.length > 0) {
                selectChat(currentProject, project.chats[0].id);
            } else {
                currentChat = null;
                showProjectWelcome(currentProject);
            }
            
            renderSidebar();
            WeraserCore.ui.showNotification('Ï±ÑÌåÖ ÏÇ≠Ï†úÎê®', 'success');
        }
    }
    
    // Go to admin
    function goToAdmin() {
        window.location.href = 'admin.html';
    }
    
    // Show profile
    function showProfile() {
        WeraserCore.ui.showNotification('ÌîÑÎ°úÌïÑ ÌôîÎ©¥ ÌëúÏãú', 'info');
    }
</script>
</body>
</html>